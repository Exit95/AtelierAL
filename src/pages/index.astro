---
import Layout from "../layouts/Layout.astro";
import HeroSection from "../components/HeroSection.astro";
import WorkshopCard from "../components/WorkshopCard.astro";
import CTAButton from "../components/CTAButton.astro";
import ReviewsDisplay from "../components/ReviewsDisplay.astro";
import ReviewForm from "../components/ReviewForm.astro";
import { getItems, type Artwork, type Workshop } from "../lib/storage";
// import { getCollection } from "astro:content"; // Keep for testimonials if they are still static

// Get featured artworks and upcoming workshops
const allArtworks = await getItems<Artwork>("artworks");
const featuredArtworks = allArtworks
	.filter((artwork) => artwork.featured)
	.slice(0, 6);

const allWorkshops = await getItems<Workshop>("workshops");
const upcomingWorkshops = allWorkshops
	.filter((workshop) => new Date(workshop.date) > new Date())
	.sort((a, b) => new Date(a.date).getTime() - new Date(b.date).getTime())
	.slice(0, 3);

// const allTestimonials = await getCollection("testimonials");
---

<Layout
	title="Home"
	description="ATELIER KL - Abstrakte Kunst von Katharina Lanvermann. Entdecken Sie einzigartige Kunstwerke und kreative Workshops in Ahaus."
>
	<HeroSection
		title="Kunst, die R√§ume verwandelt"
		subtitle="Abstrakte Kunstwerke und inspirierende Workshops von Katharina Lanvermann"
		primaryCTA={{ label: "Werke entdecken", href: "/werke" }}
		secondaryCTA={{ label: "Workshop buchen", href: "/workshops" }}
	/>

	<!-- Featured Artworks -->
	<section class="section py-16 dark-section">
		<div class="container">
			<div class="section-header">
				<h2 class="handwriting">Ausgew√§hlte Werke</h2>
				<p class="subtitle-light">
					Eine Auswahl meiner neuesten abstrakten Kunstwerke
				</p>
			</div>

			{
				featuredArtworks.length > 0 ? (
					<>
						<div class="carousel-container">
							<button class="carousel-btn carousel-btn-prev" aria-label="Vorheriges Werk">
								<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="15 18 9 12 15 6"></polyline></svg>
							</button>
							<div class="carousel-track-wrapper">
								<div class="carousel-track">
									{featuredArtworks.map((artwork, index) => (
										<div
											class="carousel-slide"
											data-lightbox-trigger
											data-image-url={artwork.images[0]}
											data-artwork-index={index}
										>
											<div class="artwork-preview-image">
												<img
													src={artwork.images[0]}
													alt={artwork.title}
													loading="lazy"
												/>
												<div class="artwork-overlay">
													<span class="zoom-icon">üîç</span>
												</div>
											</div>
											<h3 class="artwork-preview-title">
												{artwork.title}
											</h3>
											<p class="artwork-preview-meta">
												{artwork.size.width} √ó{" "}
												{artwork.size.height}{" "}
												{artwork.size.unit}
											</p>
										</div>
									))}
								</div>
							</div>
							<button class="carousel-btn carousel-btn-next" aria-label="N√§chstes Werk">
								<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="9 18 15 12 9 6"></polyline></svg>
							</button>
						</div>
						<div class="carousel-dots"></div>
						<div class="section-cta">
							<CTAButton
								label="Alle Werke ansehen"
								href="/werke"
								type="primary"
							/>
						</div>
					</>
				) : (
					<p class="text-center text-secondary">
						Demn√§chst finden Sie hier ausgew√§hlte Kunstwerke.
					</p>
				)
			}
		</div>
	</section>

	<!-- Workshops -->
	<section class="section py-16 dark-section">
		<div class="container">
			<div class="section-header">
				<h2 class="handwriting">Workshops</h2>
				<p class="subtitle-light">
					Entdecken Sie Ihre k√ºnstlerische Seite in kleinen Gruppen
				</p>
			</div>

			{
				upcomingWorkshops.length > 0 ? (
					<>
						<div class="grid grid-cols-1 grid-cols-md-3">
							{upcomingWorkshops.map((workshop) => (
								<WorkshopCard workshop={workshop} />
							))}
						</div>
						<div class="section-cta">
							<CTAButton
								label="Alle Workshops"
								href="/workshops"
								type="primary"
							/>
						</div>
					</>
				) : (
					<p class="text-center text-secondary">
						Neue Workshops werden in K√ºrze angek√ºndigt. Schauen Sie
						bald wieder vorbei!
					</p>
				)
			}
		</div>
	</section>

	<!-- Commission Process -->
	<section class="section py-16 dark-section">
		<div class="container">
			<div class="section-header text-center">
				<h2 class="handwriting">Ihr pers√∂nliches Kunstwerk</h2>
				<p class="subtitle-light">
					Von der Idee bis zum fertigen Werk in drei Schritten
				</p>
			</div>

			<div class="process-steps">
				<div class="process-step">
					<div class="step-number">01</div>
					<h3>Anfrage & Beratung</h3>
					<p>
						Teilen Sie mir Ihre Vorstellungen, Farbw√ºnsche und
						Raumma√üe mit. Gemeinsam entwickeln wir ein Konzept f√ºr
						Ihr individuelles Kunstwerk.
					</p>
				</div>
				<div class="process-step">
					<div class="step-number">02</div>
					<h3>Konzept & Entwurf</h3>
					<p>
						Ich erstelle einen ersten Entwurf und stimme ihn mit
						Ihnen ab. So stellen wir sicher, dass das Werk perfekt
						zu Ihren W√ºnschen passt.
					</p>
				</div>
				<div class="process-step">
					<div class="step-number">03</div>
					<h3>Umsetzung & √úbergabe</h3>
					<p>
						Ich erschaffe Ihr Kunstwerk mit gro√üer Sorgfalt. Nach
						Fertigstellung k√∂nnen Sie es abholen oder es wird zu
						Ihnen geliefert.
					</p>
				</div>
			</div>

			<div class="section-cta">
				<CTAButton
					label="Jetzt Werk anfragen"
					href="/auftragsarbeiten"
					type="primary"
				/>
			</div>
		</div>
	</section>

	<!-- Testimonials -->

	<!-- Customer Reviews -->
	<section class="section py-16" style="background-color: var(--color-surface);">
		<div class="container">
			<ReviewsDisplay />
		</div>
	</section>

	<!-- Review Form -->
	<section class="section py-16">
		<div class="container">
			<ReviewForm title="Teilen Sie Ihre Erfahrung" />
		</div>
	</section>

	<!-- Final CTA -->
	<section class="section py-16" style="background: linear-gradient(135deg, var(--color-brand-beige), var(--color-brand-beige-dark));">
		<div class="container text-center">
			<h2 class="handwriting" style="color: white;">
				Bereit f√ºr Ihr eigenes Kunstwerk?
			</h2>
			<p style="color: white; opacity: 0.9; max-width: 600px; margin: var(--space-4) auto var(--space-8);">
				Kontaktieren Sie mich f√ºr eine unverbindliche Beratung oder
				buchen Sie einen Workshop.
			</p>
			<div class="flex gap-4 justify-center" style="flex-wrap: wrap;">
				<CTAButton
					label="Kontakt aufnehmen"
					href="/kontakt"
					type="primary"
				/>
				<CTAButton
					label="Workshops ansehen"
					href="/workshops"
					type="secondary"
				/>
			</div>
		</div>
	</section>
</Layout>

<style>
	.section {
		width: 100%;
	}

	.dark-section {
		background-color: var(--color-dark);
		color: var(--color-text-light);
	}

	.handwriting {
		font-family: 'Dancing Script', cursive;
		font-size: clamp(2.5rem, 5vw, 4rem);
		font-weight: 500;
		color: white;
	}

	.subtitle-light {
		color: var(--color-light);
	}

	.section-header {
		text-align: center;
		margin-bottom: var(--space-12);
	}

	.section-header h2 {
		margin-bottom: var(--space-3);
	}

	.section-cta {
		display: flex;
		justify-content: center;
		margin-top: var(--space-12);
	}

	.artwork-preview {
		display: block;
		text-decoration: none;
		color: inherit;
		transition: transform var(--transition-base);
	}

	.artwork-preview:hover {
		transform: translateY(-4px);
	}

	.artwork-preview-image {
		position: relative;
		margin-bottom: var(--space-4);
		overflow: hidden;
		border-radius: var(--radius-lg);
	}

	.artwork-preview-image img {
		width: 100%;
		height: auto;
		display: block;
		transition: transform 0.3s ease;
	}

	.artwork-preview:hover .artwork-preview-image img {
		transform: scale(1.05);
	}

	.artwork-overlay {
		position: absolute;
		top: 0;
		left: 0;
		right: 0;
		bottom: 0;
		background: rgba(0, 0, 0, 0.4);
		display: flex;
		align-items: center;
		justify-content: center;
		opacity: 0;
		transition: opacity 0.3s ease;
	}

	.artwork-preview:hover .artwork-overlay {
		opacity: 1;
	}

	.zoom-icon {
		font-size: 2rem;
		color: white;
	}

	.artwork-preview-title {
		font-size: var(--font-size-lg);
		margin-bottom: var(--space-2);
		color: white;
	}

	.artwork-preview-meta {
		font-size: var(--font-size-sm);
		color: var(--color-light);
	}

	.process-steps {
		display: grid;
		grid-template-columns: 1fr;
		gap: var(--space-6);
		margin-bottom: var(--space-8);
	}

	@media (min-width: 768px) {
		.process-steps {
			grid-template-columns: repeat(3, 1fr);
			gap: var(--space-8);
		}
	}

	.process-step {
		text-align: center;
		padding: var(--space-6);
		color: white;
	}

	.step-number {
		font-family: var(--font-headline);
		font-size: var(--font-size-4xl);
		font-weight: var(--font-weight-bold);
		color: var(--color-brand-beige);
		margin-bottom: var(--space-4);
	}

	.process-step h3 {
		margin-bottom: var(--space-3);
		color: white;
	}

	.process-step p {
		color: var(--color-light);
	}

	.testimonials-grid {
		display: grid;
		grid-template-columns: 1fr;
		gap: var(--space-4);
	}

	@media (min-width: 768px) {
		.testimonials-grid {
			grid-template-columns: repeat(2, 1fr);
			gap: var(--space-6);
		}
	}

	@media (min-width: 1024px) {
		.testimonials-grid {
			grid-template-columns: repeat(3, 1fr);
		}
	}

	.testimonial-card {
		padding: var(--space-6);
		background-color: var(--color-surface-elevated);
		border-radius: var(--radius-lg);
		box-shadow: var(--shadow-base);
	}

	.testimonial-stars {
		font-size: var(--font-size-lg);
		margin-bottom: var(--space-4);
	}

	.testimonial-text {
		font-style: italic;
		line-height: var(--line-height-relaxed);
		margin-bottom: var(--space-4);
	}

	.testimonial-author {
		display: flex;
		flex-direction: column;
		gap: var(--space-1);
	}

	.testimonial-author span {
		font-size: var(--font-size-sm);
		color: var(--color-text-secondary);
	}

	/* Carousel Styles */
	.carousel-container {
		position: relative;
		display: flex;
		align-items: center;
		gap: var(--space-4);
	}

	.carousel-track-wrapper {
		overflow: hidden;
		flex: 1;
	}

	.carousel-track {
		display: flex;
		gap: var(--space-6);
		transition: transform 0.5s ease-in-out;
	}

	.carousel-slide {
		flex: 0 0 100%;
		min-width: 0;
		cursor: pointer;
		transition: transform var(--transition-base);
	}

	.carousel-slide:hover {
		transform: translateY(-4px);
	}

	@media (min-width: 640px) {
		.carousel-slide {
			flex: 0 0 calc(50% - var(--space-3));
		}
	}

	@media (min-width: 1024px) {
		.carousel-slide {
			flex: 0 0 calc(33.333% - var(--space-4));
		}
	}

	.carousel-btn {
		flex-shrink: 0;
		width: 48px;
		height: 48px;
		border-radius: 50%;
		background: var(--color-brand-beige);
		color: white;
		border: none;
		cursor: pointer;
		display: flex;
		align-items: center;
		justify-content: center;
		transition: all 0.3s ease;
		box-shadow: var(--shadow-md);
	}

	.carousel-btn:hover {
		background: var(--color-brand-beige-dark, #a08060);
		transform: scale(1.1);
	}

	.carousel-btn:disabled {
		opacity: 0.3;
		cursor: not-allowed;
		transform: none;
	}

	@media (max-width: 639px) {
		.carousel-btn {
			display: none;
		}
	}

	.carousel-dots {
		display: flex;
		justify-content: center;
		gap: var(--space-2);
		margin-top: var(--space-6);
	}

	.carousel-dot {
		width: 10px;
		height: 10px;
		border-radius: 50%;
		background: var(--color-border);
		border: none;
		cursor: pointer;
		transition: all 0.3s ease;
	}

	.carousel-dot.active {
		background: var(--color-brand-beige);
		transform: scale(1.2);
	}

	.carousel-dot:hover {
		background: var(--color-brand-beige);
	}
</style>

<script>
	document.addEventListener('DOMContentLoaded', () => {
		const track = document.querySelector('.carousel-track') as HTMLElement;
		const slides = document.querySelectorAll('.carousel-slide');
		const prevBtn = document.querySelector('.carousel-btn-prev') as HTMLButtonElement;
		const nextBtn = document.querySelector('.carousel-btn-next') as HTMLButtonElement;
		const dotsContainer = document.querySelector('.carousel-dots') as HTMLElement;

		if (!track || slides.length === 0) return;

		let currentIndex = 0;
		let slidesPerView = 1;
		let autoplayInterval: ReturnType<typeof setInterval>;

		// Calculate slides per view based on screen width
		function updateSlidesPerView() {
			if (window.innerWidth >= 1024) {
				slidesPerView = 3;
			} else if (window.innerWidth >= 640) {
				slidesPerView = 2;
			} else {
				slidesPerView = 1;
			}
		}

		// Create dots
		function createDots() {
			dotsContainer.innerHTML = '';
			const totalDots = Math.ceil(slides.length / slidesPerView);
			for (let i = 0; i < totalDots; i++) {
				const dot = document.createElement('button');
				dot.classList.add('carousel-dot');
				if (i === 0) dot.classList.add('active');
				dot.addEventListener('click', () => goToSlide(i * slidesPerView));
				dotsContainer.appendChild(dot);
			}
		}

		// Update dots
		function updateDots() {
			const dots = document.querySelectorAll('.carousel-dot');
			const activeDotIndex = Math.floor(currentIndex / slidesPerView);
			dots.forEach((dot, i) => {
				dot.classList.toggle('active', i === activeDotIndex);
			});
		}

		// Go to specific slide
		function goToSlide(index: number) {
			const maxIndex = slides.length - slidesPerView;
			currentIndex = Math.max(0, Math.min(index, maxIndex));

			const slideWidth = (slides[0] as HTMLElement).offsetWidth;
			const gap = 24; // var(--space-6)
			track.style.transform = `translateX(-${currentIndex * (slideWidth + gap)}px)`;

			updateDots();
			updateButtons();
		}

		// Update button states
		function updateButtons() {
			if (prevBtn) prevBtn.disabled = currentIndex === 0;
			if (nextBtn) nextBtn.disabled = currentIndex >= slides.length - slidesPerView;
		}

		// Next slide
		function nextSlide() {
			if (currentIndex < slides.length - slidesPerView) {
				goToSlide(currentIndex + 1);
			} else {
				goToSlide(0); // Loop back to start
			}
		}

		// Previous slide
		function prevSlide() {
			if (currentIndex > 0) {
				goToSlide(currentIndex - 1);
			}
		}

		// Start autoplay
		function startAutoplay() {
			autoplayInterval = setInterval(nextSlide, 4000);
		}

		// Stop autoplay
		function stopAutoplay() {
			clearInterval(autoplayInterval);
		}

		// Event listeners
		if (prevBtn) prevBtn.addEventListener('click', () => { stopAutoplay(); prevSlide(); startAutoplay(); });
		if (nextBtn) nextBtn.addEventListener('click', () => { stopAutoplay(); nextSlide(); startAutoplay(); });

		// Pause on hover
		track.addEventListener('mouseenter', stopAutoplay);
		track.addEventListener('mouseleave', startAutoplay);

		// Handle resize
		window.addEventListener('resize', () => {
			updateSlidesPerView();
			createDots();
			goToSlide(0);
		});

		// Initialize
		updateSlidesPerView();
		createDots();
		updateButtons();
		startAutoplay();
	});
</script>
